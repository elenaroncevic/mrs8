-- MySQL Script generated by MySQL Workbench
-- Sat May  5 00:00:43 2018
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

-- -----------------------------------------------------
-- Table `mydb`.`Cinema`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Cinema` (
  `cid` INT NOT NULL AUTO_INCREMENT,
  `cname` VARCHAR(45) NOT NULL,
  `clocation` VARCHAR(60) NOT NULL,
  `cdecription` VARCHAR(1000) NOT NULL,
  `cactors` VARCHAR(1000) NOT NULL,
  `crating` DOUBLE NOT NULL DEFAULT 0,
  UNIQUE INDEX `id_UNIQUE` (`cid` ASC),
  PRIMARY KEY (`cid`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Movie`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Movie` (
  `mid` INT NOT NULL AUTO_INCREMENT,
  `title` VARCHAR(45) NOT NULL,
  `director` VARCHAR(45) NOT NULL,
  `mrating` DOUBLE NOT NULL,
  `poster` LONGBLOB NOT NULL,
  `duration` INT NOT NULL,
  `mdescription` VARCHAR(1000) NOT NULL,
  PRIMARY KEY (`mid`),
  UNIQUE INDEX `mid_UNIQUE` (`mid` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Projection`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Projection` (
  `pid` INT NOT NULL AUTO_INCREMENT,
  `movie` INT NOT NULL,
  `pauditorium` INT NOT NULL,
  `ptime` DATETIME NOT NULL,
  `price` DOUBLE NOT NULL,
  PRIMARY KEY (`pid`, `movie`, `ptime`, `pauditorium`),
  UNIQUE INDEX `pid_UNIQUE` (`pid` ASC),
  INDEX `movie_idx` (`movie` ASC),
  CONSTRAINT `projmovFK`
    FOREIGN KEY (`movie`)
    REFERENCES `mydb`.`Movie` (`mid`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `projaudFK`
    FOREIGN KEY (`pauditorium`)
    REFERENCES `mydb`.`Auditorium` (`aid`)
    ON DELETE CASCADE
    ON UPDATE CASCADE))
    
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Auditorium`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Auditorium` (
  `aid` INT NOT NULL AUTO_INCREMENT,
  `acinema` INT NOT NULL,
  PRIMARY KEY (`aid`, `acinema`),
  UNIQUE INDEX `aid_UNIQUE` (`aid` ASC),
  INDEX `cid_idx` (`acinema` ASC),
  CONSTRAINT `audcinFK`
    FOREIGN KEY (`acinema`)
    REFERENCES `mydb`.`Cinema` (`cid`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Sector`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Sector` (
  `sid` INT NOT NULL,
  `sauditorium` INT NOT NULL,
  PRIMARY KEY (`sid`, `sauditorium`),
  UNIQUE INDEX `sid_UNIQUE` (`sid` ASC),
  INDEX `aid_idx` (`sauditorium` ASC),
  CONSTRAINT `secaudFK`
    FOREIGN KEY (`sauditorium`)
    REFERENCES `mydb`.`Auditorium` (`aid`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`Seat`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`Seat` (
  `seid` INT NOT NULL AUTO_INCREMENT,
  `snumber` INT NOT NULL,
  `sector` INT NOT NULL,
  PRIMARY KEY (`seid`, `snumber`, `sector`),
  UNIQUE INDEX `idSeat_UNIQUE` (`sector` ASC),
  UNIQUE INDEX `snumber_UNIQUE` (`snumber` ASC),
  UNIQUE INDEX `seid_UNIQUE` (`seid` ASC),
  CONSTRAINT `seatsecFK`
    FOREIGN KEY (`sector`)
    REFERENCES `mydb`.`Sector` (`sid`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `mydb`.`QuickTicket`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `mydb`.`QuickTicket` (
  `qid` INT NOT NULL AUTO_INCREMENT,
  `discount` INT NOT NULL,
  `projection` INT NOT NULL,
  `seat` INT NOT NULL,
  PRIMARY KEY (`qid`, `projection`, `seat`),
  UNIQUE INDEX `qid_UNIQUE` (`qid` ASC),
  INDEX `projectionFK_idx` (`projection` ASC),
  INDEX `seatFK_idx` (`seat` ASC),
  CONSTRAINT `qtprojFK`
    FOREIGN KEY (`projection`)
    REFERENCES `mydb`.`Projection` (`pid`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `qtseatFK`
    FOREIGN KEY (`seat`)
    REFERENCES `mydb`.`Seat` (`seid`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
